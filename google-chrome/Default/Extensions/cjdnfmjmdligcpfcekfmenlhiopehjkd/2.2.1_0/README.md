# TwoSeven Extension

This WebExtension has been written to enhance the features of [twoseven.xyz](https://twoseven.xyz) by allowing users to watch together, content from Netflix, Amazon, HBO and other sources. The extension consists of several components, each handling different features. Overall, the extension is hierarchically split up into directories
for each of the components. The `content-script` and `background-script` for each component can be found within it's corresponding directory.

## Build Instructions
To re-create a replica of the production version of the extension, run the following commands:
If you're on Linux, simply run: `./scripts/setup.sh`

Otherwise, with nodeJS (we use `v14.15.3`) installed, run
```
# Only need to run once
npm install

# Only need to run once
npm run init
```

Finally, to build the extension, run:
```
npm run build:modules
npm run build
```

This will produce two directories, `dist-chrome` and `dist-firefox` which will contain a copy of our production version of the extension.

## External Libraries
The extension uses several open-source libraries. All of these can also be found in the attached `package.json` file. Which has been included so that reviewers may note the specific version numbers of each library.

  - VueJS ([github](https://github.com/vuejs/vue))
  - xml-js ([github](https://github.com/nashwaan/xml-js))
  - plyr ([github](https://github.com/sampotts/plyr))
  - screenfull ([github](https://github.com/sindresorhus/screenfull))
  - node-md5 ([github](https://github.com/pvorb/node-md5))
  - emittery ([github](https://github.com/sindresorhus/emittery))
  - on-change ([github](https://github.com/sindresorhus/on-change))
  - axios ([github](https://github.com/axios/axios))
  - xregexp ([github](https://github.com/slevithan/xregexp))
  - moment ([github](https://github.com/moment/moment))
  - keymaster ([github](https://github.com/madrobby/keymaster))
  - is_js ([github](https://github.com/arasatasaygin/is.js))
  - URI.js ([github](https://github.com/medialize/URI.js))
  - socket.io-client ([github](https://github.com/socketio/socket.io-client))
  - m3u8-parser ([github](https://github.com/videojs/m3u8-parser))
  - deepmerge ([github](https://github.com/TeHShrike/deepmerge))
  - jwt-decode ([github](https://github.com/auth0/jwt-decode))
  - auth0-chrome ([github](https://github.com/auth0-community/auth0-chrome))
  - crunchyroll-api ([github](https://github.com/gurupras/crunchyroll-api))
  - node-uuid ([github](https://github.com/kelektiv/node-uuid))
  - node-semver ([github](https://github.com/npm/node-semver))
  - ip ([github](https://github.com/indutny/node-ip))
  - dot-prop ([github](https://github.com/sindresorhus/dot-prop))
  - lodash ([github](https://github.com/lodash/lodash))
  - querystringify ([github](https://github.com/unshiftio/querystringify))
  - flat ([github](https://github.com/hughsk/flat))
  - mpd-parser ([github](https://github.com/videojs/mpd-parser))
  - subsrt ([github](https://github.com/gurupras/subsrt))
  - js-cookie ([github](https://github.com/js-cookie/js-cookie))
  - lru-cache ([github](https://github.com/isaacs/node-lru-cache))

A small subset of these libraries do not come with browser-ready code. As a result, a browser bundle was generated for these libraries:
  - lodash: debounce, throttle (exported under window.twoseven)
  - dot-prop
  - emittery
  - ip
  - is_js (exported as window.twoseven.is)
  - node-md5
  - on-change
  - node-semver
  - node-uuid
  - querystringify
  - flat
  - mpd-parser
  - subsrt
  - plyr
  - lru-cache


The bundles of these libraries can be generated using the following commands:

```
npm run build -- webpack
```

You can then do a diff to confirm that the files present in `js/redist/*` match the files generated by the above webpack bundler.

## External Components
Over the years, this extension has grown to encompass a lot of features to enable a seamless watching-together experience. We're in the process of splitting up and open-sourcing multiple components of the extension to manage it better. As a consequence the following components are included in a prebuilt/minified version but have their sources available online:

  - extension-popup ([github](https://github.com/twosevenxyz/extension-popup))
  - extension-modal ([github](https://github.com/twosevenxyz/extension-modal))
  - extension-options ([github](https://github.com/twosevenxyz/extension-options))

The above components use VueJS and are bundled using Webpack. Packaging the Vue components this way allows us to remove `'unsafe-eval'` from our extension's CSP.
These bundles can be re-created using the following commands:

```
npm run build:modules
```
