(()=>{if(window.top===window)return;const e="watch-iframe[viaplay.no]",n=new WebpageIframeModule({name:e,hrefURLRegex:new RegExp("https://(.*\\.)?viaplay.no/player/default/.*"),earlyInitialize(){const e=browser.runtime.connect({name:name});this.port=e,window.addEventListener("found-media",async function(e){this.mediaEntry=await window.twoseven.processConfig(window.location.href,e.detail.data)}.bind(this));const n=new RegExp("https://assets.viaplay.tv/frontend-[0-9]+/app\\.[a-z0-9]+.js");e.postMessage({action:"block-url",urls:[n.toString()]}),setupScriptModifier(name,e=>n.test(e.src),new ScriptModifierMap([{key:new XRegExp("(?<fnstart>var [a-zA-Z0-9_]+=\\{VIDEO_BEHIND_DVR:function\\(\\)\\{return (?<player>e.player))"),value:new ScriptModifierEntry({replace:"window.twoseven.viaplayController = e.player; window.twoseven.viaplayCore = e.core; ${fnstart}"})},{key:new XRegExp("UI_PLAY:function\\(\\)\\{(?<fncontent>return [a-zA-Z0-9_]+.player.play\\(\\))\\}"),value:new ScriptModifierEntry({replace:"UI_PLAY:function(skip) {\n              if (skip) {\n                return window.twoseven.viaplayController.play()\n              }\n              triggerEvent(window, 'controller-event', { action: 'play' });\n            }"})},{key:new XRegExp("UI_PAUSE:function\\(\\)\\{(?<fncontent>return [a-zA-Z0-9_]+.player.pause\\(\\))\\}"),value:new ScriptModifierEntry({replace:"UI_PAUSE:function(skip) {\n              if (skip) {\n                return window.twoseven.viaplayController.pause()\n              }\n              triggerEvent(window, 'controller-event', { action: 'pause' })\n            }"})},{key:new XRegExp("UI_SEEK:function\\((?<var>[a-zA-Z0-9_]+)\\)\\{(?<fncontent>return [a-zA-Z0-9_]+.player.time\\((?<position>.*?)\\))\\}"),value:new ScriptModifierEntry({replace:"UI_SEEK:function(t) {\n              triggerEvent(window, 'controller-event', { action: 'seek', position: t })\n            }"})},{key:new XRegExp('(?<fnstart>onScrubStart:function\\(\\)\\{[a-zA-Z0-9_]+\\.dispatch\\(\\{type:"WEB_UI_SCRUB_START"}\\)),(?<var>[a-zA-Z0-9_]+)\\.core\\.emit\\("UI_PAUSE"\\)'),value:new ScriptModifierEntry({replace:'${fnstart},${var}.core.emit("UI_PAUSE", true)'})},{key:new XRegExp('(?<fnstart>onScrubEnd:function\\([a-zA-Z0-9_]+\\)\\{[a-zA-Z0-9_]+\\.core\\.emit\\("UI_SEEK",[a-zA-Z0-9_]+\\)),(?<var>[a-zA-Z0-9+]+)\\.core\\.emit\\("UI_PLAY"\\)'),value:new ScriptModifierEntry({replace:'${fnstart},${var}.core.emit("UI_PLAY", true)'})},{key:new XRegExp('(?<fnstart>[a-zA-Z0-9_]+\\.on\\("WEB_UI_FULLSCREEN_ON",function\\(\\){)(?<fncontent>\\(0,[a-zA-Z0-9_]+\\.reqFullscreen\\)\\([a-zA-Z0-9_]+\\)}\\))'),value:new ScriptModifierEntry({replace:"${fnstart}return triggerEvent(window, 'controller-event', { action: 'fullscreen' })})"})},{key:new XRegExp('(?<fnstart>[a-zA-Z0-9_]+\\.on\\("WEB_UI_FULLSCREEN_OFF",function\\(\\){)(?<fncontent>\\(0,[a-zA-Z0-9_]+\\.exitFullscreen\\)\\(\\)}\\))'),value:new ScriptModifierEntry({replace:"${fnstart}return triggerEvent(window, 'controller-event', { action: 'fullscreen' })})"})}],"viaplay.no.js"),"body"),window.addEventListener("controller-event",function(e){const{detail:{data:n}}=e,{action:t}=n;switch(t){case"play":this.video.play();break;case"pause":this.video.pause();break;case"seek":this.video.seek(1e3*n.position);break;case"fullscreen":window.twoseven.fullscreenHandlers.toggleFullscreen()}}.bind(this))},fullscreenCallback:()=>!0,useActionsAsControls:!0,getActions:()=>window.twoseven.initializeGenericIframeActions(),getVideo(){return this.video},onVideo(e){this.video=e,this.url=window.location.href;const{video:n}=e,t=this;n.addEventListener("play",function e(){n.removeEventListener("play",e);let r=0;n.addEventListener("timeupdate",function e(){++r<2||(n.removeEventListener("timeupdate",e),setTimeout(()=>{injectScript("\n              const controller = window.twoseven.viaplayController\n              controller.pause()\n              ",!0),t.on("same-url",()=>t.emit("controller-initialized")),t.emit("controller-ready",t.mediaEntry)},100))})})},isValidVideoElement:()=>!0});registerWebpageIframeModule(n)})();