(()=>{const t=["srt","vtt","ttml","sub","sbv","lrc","smi","ssa","ass"];browser.webRequest.onHeadersReceived.addListener(async e=>{const{tabId:s,frameId:r}=e;if(e.url.includes("twoseven-bypass=true"))return;if(!function(e,s){const r=getHeaderValue("content-type",s)||"";for(const s of t)if(e.url.includes(`.${s}`)||r.includes(s))return!0;return!1}(e,e.responseHeaders))return;const a=new URI(e.url),n=a.query(!0);n["twoseven-bypass"]="true",a.addSearch(n);const o=a.toString();let c;try{const t=await axios.get(o),{data:s}=t;if(!subsrt.detect(s))return;c=subsrt.convert(s,{format:"vtt"})}catch(e){}const i={vtt:c,url:o},d=c?md5(c):md5(o);perTabCaptions[s]||(perTabCaptions[s]={}),perTabCaptions[s][d]||(perTabCaptions[s][d]=i,perTabCaptions.emit("add-track",{tabId:s,captionData:i}),browser.tabs.executeScript(s,{frameId:r,allFrames:!1,code:`window.postTo(window, {\n            action: 'found-caption',\n            data: ${JSON.stringify(i)}\n          })`}))},{urls:["<all_urls>"]},["responseHeaders"])})();