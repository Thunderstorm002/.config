const blockedUrls={},redirectUrls={};browser.runtime.onConnect.addListener(r=>{r.onMessage.addListener(e=>{const t=getTabIdFromPort(r);switch(e.action){case"block-url":blockedUrls[t]||(blockedUrls[t]=[]),blockedUrls[t].push(...e.urls);break;case"redirect-url":redirectUrls[t]||(redirectUrls[t]={}),Object.entries(e.urls).forEach(([e,s])=>{redirectUrls[t][e]={target:s,port:r}})}})}),browser.webRequest.onBeforeRequest.addListener(r=>{const e=blockedUrls[r.tabId],t=redirectUrls[r.tabId];if(0!==r.frameId&&twosevenTabs[r.tabId]&&(e||t)){if(e&&e.some(e=>r.url.match(e)))return{cancel:!0};if(t){let e=t[r.url],s=r.url;if(!e){if(!(s=Object.keys(t).find(e=>r.url.match(e))))return;e=t[s]}const{target:c,port:l}=e;return l.postMessage({action:"redirect-url",data:{src:s,target:c}}),{redirectUrl:c}}}},{urls:["<all_urls>"],types:["script"]},["blocking"]);