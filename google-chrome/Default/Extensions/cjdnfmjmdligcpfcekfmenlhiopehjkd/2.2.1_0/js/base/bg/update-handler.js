function getVersion(){let e;try{e=browser.app.getDetails().version}catch(t){e=browser.runtime.getManifest().version}return e}!function(){const e="https://blog.twoseven.xyz/extension-updates/";var t,s=getVersion(),o=localStorage.version;s!==o&&(void 0===o?(t=s,console.log("Extension Installed"),browser.tabs.create({url:`${e}?install=true&version=${t}`})):async function(t,s){const o=["resync-samesite-cookies"];try{const e=await axios.get("https://twoseven.xyz/api/extension-commands",{params:{v:t,old:s}}),{data:n}=e;o.push({cmd:"update-settings",args:{target:"GENERAL_GENERIC_FALLBACK_WEBSITES",from:{src:"default",key:"GENERAL_GENERIC_FALLBACK_WEBSITES"},strategy:"merge"}}),o.push(...n)}catch(e){}for(const e of o){const{cmd:t,args:s}=e;switch(t){case"logout":logout();break;case"update-settings":settingsReady.then(()=>updateSettings(s)),o.find(e=>"notification"===e.cmd)||console.warn("Every update-settings extension command is expected to have a notification");break;case"resync-samesite-cookies":settingsReady.then(resyncTwoSevenCookieStore);break;case"notification":browser.notifications.create({type:"basic",title:s.title||"Notice",message:s.msg,iconUrl:"icons/icon-64x64.png"})}}const n=semver.coerce(s),r=semver.coerce(t);console.log("Extension Updated"),n.minor===r.minor&&n.major===r.major||browser.tabs.create({url:`${e}?version=${t}`})}(s,o),localStorage.version=s),browser.runtime.onConnect.addListener(e=>{"update-handler-cs"===e.name&&e.onMessage.addListener(()=>{e.postMessage({version:getVersion()})})}),browser.runtime.onConnect.addListener(e=>{e.onMessage.addListener(t=>{t&&t.action&&"get-extension-version"===t.action&&e.postMessage({version:getVersion()})})})}();