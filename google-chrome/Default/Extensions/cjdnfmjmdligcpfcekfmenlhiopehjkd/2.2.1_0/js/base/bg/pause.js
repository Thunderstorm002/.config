function getBrowserActionIcon(e){return isPausedOnWebsite(e)||isPausedOnAllWebsites()?"icons/icon-16x16-grayscale.png":"icons/icon-16x16.png"}function updateBrowserActionIcon(){browser.tabs.query({},e=>{e.forEach(e=>{const s=e.id,t=getBrowserActionIcon(e.url);browser.browserAction.setIcon({path:t,tabId:s})})})}let pausedWebsites;try{pausedWebsites=new Set(JSON.parse(localStorage.getItem("pausedWebsites")))}catch(e){pausedWebsites=new Set}let pausedOnAllWebsites=!1;try{pausedOnAllWebsites=JSON.parse(localStorage.getItem("pausedOnAllWebsites"))}catch(e){}function getHost(e){return new URI(e).host()}function pauseOnWebsite(e,s){const t=getHost(e);s?pausedWebsites.add(t):pausedWebsites.delete(t),localStorage.setItem("pausedWebsites",JSON.stringify([...pausedWebsites]))}function isPausedOnWebsite(e){return!!e&&pausedWebsites.has(getHost(e))}function isPausedOnAllWebsites(){return pausedOnAllWebsites}function pauseOnAllWebsites(e){pausedOnAllWebsites=e,localStorage.setItem("pausedOnAllWebsites",JSON.stringify(e))}browser.tabs.query({currentWindow:!0},e=>{for(const s of e){const{id:e,url:t}=s;browser.browserAction.setIcon({path:getBrowserActionIcon(t),tabId:e})}}),browser.runtime.onConnect.addListener(e=>{const s=getTabIdFromPort(e),{sender:{frameId:t}}=e;e.onMessage.addListener(e=>{switch(e.action){case"url-changed":{const{url:t}=e.data,n=getBrowserActionIcon(t);browser.browserAction.setIcon({path:n,tabId:s});break}}})}),browser.runtime.onMessage.addListener(async(e,s)=>{const{action:t}=e;switch(t){case"pause-state":{const{tab:{id:e},frameId:t}=s,n=isPausedOnWebsite(tabURLs[e])||isPausedOnAllWebsites();browser.tabs.executeScript(e,{frameId:t,code:`triggerEvent(window, 'twoseven:pause-state-response', JSON.stringify({ isPaused: ${n} }), true)`});break}}});