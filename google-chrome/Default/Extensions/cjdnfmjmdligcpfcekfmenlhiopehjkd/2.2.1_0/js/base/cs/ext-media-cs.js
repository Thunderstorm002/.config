!function(){const e="ext-media-cs",t=browser.runtime.connect({name:e});t.onMessage.addListener(e=>{switch(e.to){case"cs:get-ext-data":injectScript(`\n          appBus.$emit('on-ext-data', ${JSON.stringify(e)})\n        `);break;case"cs:on-module-help":injectScript(`\n          appBus.$emit('on-module-help', ${JSON.stringify(e)})\n        `);break;case"cs:search-for-media":injectScript(`\n          appBus.$emit('search-for-media-complete', ${JSON.stringify(e)})\n        `)}}),document.addEventListener("get-ext-data",e=>{t.postMessage({to:"bg:get-ext-data",...e.detail.data})}),document.addEventListener("request-module-help",e=>{t.postMessage({to:"bg:request-module-help",...e.detail.data})}),document.addEventListener("module-after-media-load",async e=>{const t=e.detail.data;try{const a=getModule(t.videoData.module);await a.afterMediaLoad(t)}catch(e){}finally{injectScript(`\n        appBus.$emit('module-after-media-load-complete', ${JSON.stringify(t)})\n      `)}}),document.addEventListener("load-media-from-module",async e=>{const t=e.detail.data;try{const a=getModule(t.videoData.module);await a.loadMedia(t)}catch(e){}finally{injectScript(`\n        appBus.$emit('load-media-from-module-complete', ${JSON.stringify(t)})\n      `)}}),document.addEventListener("search-for-media",async e=>{t.postMessage({to:"bg:search-for-media",...e.detail.data})}),document.addEventListener("after-tab-media-fetch",async e=>{t.postMessage({...e.detail.data,to:"bg:after-tab-media-fetch"})}),document.addEventListener("ext-source-change-check",async e=>{const{detail:{data:t}}=e,{oldMediaEntry:a,newMediaEntry:n,__evtId:d}=t,i={__evtId:d,isEqual:!1};try{const t=window.getMatchingWebpageIframeModule(n.videoURL);if(!t)throw new Error(`Failed to find module for url: ${n.videoURL}`);const d=await t.doVideoURLsMatch(a,n);i.isEqual=d}catch(e){}injectScript(`\n      appBus.$emit('ext-source-change-check-response', ${JSON.stringify(i)})\n    `)}),twosevenExtLog(e,"Setup ext-data listener"),document.addEventListener("xhr-help",async e=>{const t=`xhr-help-${1e9*Math.random()|0}`,a=JSON.parse(JSON.stringify(e.detail.data)),n=a.__evtId;Object.assign(a,{__evt_name:"xhr-help",ack:{event:t}}),window.addEventListener("message",function({data:e}){e.action&&e.action===t&&(window.removeEventListener("message",this),Object.assign(e,{__evtId:n}),injectScript(`\n        appBus.$emit('xhr-help-complete', ${JSON.stringify(e)})\n      `))}),window.postMessage(a)})}();