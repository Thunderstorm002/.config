(async()=>{if(window!==window.top)return;const e="https://discover.hulu.com/content/v3/entity?device_context_id=1&eab_ids={{contentID}}&language=en&referral_host=www.hulu.com&schema=4",t=new RegExp("https://(.*\\.)?hulu\\.com/watch/.*"),o="[hulu:media-detector]",n=o,i=browser.runtime.connect({name:o});async function a(a=window.location.href){if(twosevenExtLog(n,`Moving to ${a}`),i.postMessage({action:"clear-tab-media"}),!t.test(a))return void twosevenExtLog(n,`Does not match videoRegex pattern: ${a}`);const s=await new Promise(e=>{let t=!1;const o=setTimeout(()=>{t=!0,e()},1e4);once(window,"ts-content-id",n=>{t||(clearTimeout(o),e(n.detail))})});let r,d,c,w,l,u;try{if(s){const t=e.replace(/{{contentID}}/,encodeURIComponent(s)),n=await fetch(t),i=await n.json(),{items:[a]}=i,{_type:m}=a;r=a.name;try{d=a.series_artwork["program.tile"].path;const e=JSON.stringify([{resize:"600x600|max"},{format:"jpeg"}]);d+=`&operations=${encodeURIComponent(e)}`}catch(e){}c="episode"===m?Number(a.season):void 0,w="episode"===m?Number(a.number):void 0,l=a.series_name,u=o}}catch(e){}i.postMessage({action:"add-tab-media",from:"websites/hulu/video-detect-cs",to:"bg/tag-media",data:{videoSelector:"hulu",videoURL:a,videoData:{title:r,poster:d,seasonIndex:c,episodeIndex:w,showTitle:l,episodeTitle:u,referer:window.location.href,isLocked:{reason:"privilege",value:"VIDEO_SELECTOR_HULU",until:1669888e6}},referer:window.location.href,origin:window.location.href,strategies:null,headers:[]}})}i.onMessage.addListener(e=>{const{action:t}=e;if("player-event"!==t)return;const{data:{content_id:o}}=e;o&&triggerEvent(window,"ts-content-id",o,!0)}),window.addEventListener("pushstate",e=>a(`${window.location.origin}${e.detail.data.uri}`)),a()})();