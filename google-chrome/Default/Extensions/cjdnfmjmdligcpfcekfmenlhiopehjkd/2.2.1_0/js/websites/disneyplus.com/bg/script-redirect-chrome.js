(async()=>{const e="[disney+:script-redirect]",s=window.twoseven.disneyPlusReplaceURL;let t,n=await r(s);async function r(s){return pullScriptAndModify(s,window.twoseven.disneyPlusReplaceMap,e)}Object.defineProperties(window.twoseven,{disneyPlusScriptContent:{get:()=>n}});const a=new XRegExp('<script[^<>]+src="(?<bundleURL>https://prod-static\\.disney-plus\\.net/[^<>]+/builds/[^<>]+/scripts/app_script_bundle.js)"[^<>]+><\/script>');async function i(){const{urlChanged:s,url:i}=await async function(){const e=await axios.get("https://www.disneyplus.com/video/52b36beb-a977-4020-9faf-83aea7ef5121"),s=XRegExp.exec(e.data,a),{bundleURL:n}=s,r=n!==t;let i;t=n;const c=await axios.get(n),o=new XRegExp('lottie.*:"(\\S*playerADK)"'),d=XRegExp.exec(c.data,o);if(d){const e=d[1];i=n.replace("app_script_bundle.js",`${e}.js`)}return{urlChanged:r,url:i}}();s&&(n=await r(i),twosevenExtLog(e,"Updated playerADK script"))}i(),setInterval(i,6e4),browser.runtime.onConnect.addListener(async e=>{["watch-iframe[disneyplus.com]"].includes(e.name)&&-1!==getTabIdFromPort(e)&&e.onMessage.addListener(t=>{const{action:r}=t;switch(r){case"script-content":e.postMessage({action:"script-content",data:{bundleURL:s,scriptContent:n}})}})});const c=new RegExp("https://prod-static\\.disney-plus\\.net/.*builds/.*/scripts/app_script_bundle.js(\\?cache-buster=[0-9]+)?$");browser.webRequest.onBeforeRequest.addListener(s=>{if(!c.test(s.url))return;if(s.url.includes("ts-bypass=1"))return;const{tabId:t,frameId:n}=s;return twosevenTabs[t]?(browser.tabs.executeScript(t,{frameId:n,code:`triggerEvent(window, 'blocked-script', { url: '${s.url}' })`}),twosevenExtLog(e,"Blocked default app_script_bundle.js"),{cancel:!0}):void 0},{urls:["<all_urls>"]},["blocking"]),browser.webRequest.onHeadersReceived.addListener(e=>{const{tabId:s}=e;if(-1===s)return removeHeaderEntry("content-security-policy",e.responseHeaders),removeHeaderEntry("x-frame-options",e.responseHeaders),{responseHeaders:e.responseHeaders}},{urls:["https://*.disneyplus.com/*"]},["blocking","responseHeaders"])})();