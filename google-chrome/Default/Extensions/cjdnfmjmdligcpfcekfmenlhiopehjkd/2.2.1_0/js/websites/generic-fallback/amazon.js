(()=>{const e="generic-fallback[amazon]",t=e,i=e;const s=new class extends BaseGenericFallbackModule{constructor(){super({name:i}),this.hrefURLRegex=new RegExp("https://(.*\\.)?(amazon|primevideo).co(m|\\.[a-z]+)/.*"),this.setupWrapOnVideo=!1}earlyInitialize(){super.earlyInitialize();const{port:e}=this;this.on("same-url",async e=>{await this.wrap(),this.video.video.pause(),this.emit("controller-initialized",e)}),e.onMessage.addListener(function(e){switch(e.action){case"sourceChange":if(!this.doVideoURLsMatch({videoURL:window.location.href},e.json)){const t=new URI(e.json.videoURL);t.addSearch({"ts-generic-fallback":1}),e.json.videoURL=t.toString(),this.emit("controller-ready",e.json)}break;case"bg-event":this.video||(this.searchInterval=this.searchInterval||setInterval(()=>{const e=Array.from(document.querySelectorAll("video"));this.emit("process-video-elements",e)},100))}}.bind(this))}async onVideo(e){super.onVideo(e),this.setupWrap(),await this.emit("controller-ready",{videoURL:this.videoURL})}isValidVideoElement(e){if(!this.video&&100===e.width)return twosevenExtLog(t,"Found valid video element"),this.searchInterval&&clearInterval(this.searchInterval),delete this.searchInterval,!0}useBodyObserver(){return!1}doVideoURLsMatch(e,t){const{videoURL:i}=e,{videoURL:s}=t,a=new URI(i),o=new URI(s);return a.path()===o.path()}setupTabMediaListeners(e){new URI(e.videoURL).addSearch({autoplay:1})}};window.registerGenericFallbackModule(s)})();